---
import Layout from '../../layouts/Layout.astro';
import PageManager from '../../components/PageManager';
import { webflow } from '../../utils/webflow/client';
import { fetchAllPages } from '../../utils/webflow/pages';
import type { WebflowPage } from '../../utils/webflow-types';

const runtime = Astro.locals.runtime;

// Get pages
const siteId = runtime?.env.WEBFLOW_SITE_ID;
if (!siteId) {
  throw new Error('WEBFLOW_SITE_ID is not defined');
}

const pages = await fetchAllPages(siteId);

// Get existing settings
const settings = await Astro.locals.exposureSettings.get('settings');
const initialSettings = settings ? JSON.parse(settings).pages : null;
---

<Layout title="Manage Pages">
  <main class="container mx-auto px-4 py-8">
    <PageManager 
      client:load 
      pages={pages} 
      initialSettings={initialSettings}
    />
  </main>
</Layout>

<script>
  // Show toast on save
  window.addEventListener('pageSettingsSaved', () => {
    const toast = document.createElement('div');
    toast.className = 'fixed bottom-4 right-4 bg-green-500 text-white px-6 py-3 rounded shadow-lg';
    toast.textContent = 'Page settings saved successfully';
    document.body.appendChild(toast);
    setTimeout(() => toast.remove(), 3000);
  });
</script> 